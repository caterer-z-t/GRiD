<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Mosdepth Coverage Analysis" href="mosdepth.html"><link rel="prev" title="Helper Functions" href="helper-functions.html">
        <link rel="prefetch" href="../_static/grid_logo.png" as="image">

    <link rel="shortcut icon" href="../_static/favicon.ico"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Read Counting Module - GRiD v0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #D91E36;
  --color-brand-content: #D91E36;
  --color-link: #D91E36;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #D91E36;
  --color-brand-content: #D91E36;
  --color-link: #D91E36;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #D91E36;
  --color-brand-content: #D91E36;
  --color-link: #D91E36;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">GRiD v0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/grid_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">GRiD v0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Welcome to GRiD’s documentation!</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">Example Pipeline Jobs</a><input aria-label="Toggle navigation of Example Pipeline Jobs" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/SOL_sbatch.html">SLURM Job Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/SOL_python.html">Python Pipeline Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../modules.html">Modules</a><input aria-label="Toggle navigation of Modules" checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="grid_core.html">GRiD Core Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities_overview.html">Utilities Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="helper-functions.html">Helper Functions</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Read Counting Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mosdepth.html">Mosdepth Coverage Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="normalize-mosdepth.html">Mosdepth Coverage Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="find-neighbors.html">Neighbor Finding Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpa-realign.html">LPA Realignment Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute-dipcn.html">Diploid Copy Number Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="estimate-kiv.html">KIV-2 Copy Number Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crai.html">CRAM Index Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="subset.html">CRAM Subsetting</a></li>
<li class="toctree-l2"><a class="reference internal" href="extract-reference.html">Extract Reference Sequences</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/modules_dir/count-reads.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="read-counting-module">
<h1>Read Counting Module<a class="headerlink" href="#read-counting-module" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<section id="read-counting-module">
<h3>Read Counting Module<a class="headerlink" href="#read-counting-module" title="Link to this heading">¶</a></h3>
<p>Count properly paired reads within specified genomic regions (e.g., LPA KIV-2 VNTR) across multiple CRAM files.</p>
<section id="purpose">
<h4>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h4>
<p>This module is the first analytical step in the GRiD pipeline. It quantifies how many properly paired, mapped reads overlap with the repeat region of interest. These counts are essential for downstream copy number estimation.</p>
</section>
<section id="main-module">
<h4>Main Module<a class="headerlink" href="#main-module" title="Link to this heading">¶</a></h4>
<section id="count-reads-py">
<h5><code class="docutils literal notranslate"><span class="pre">count_reads.py</span></code><a class="headerlink" href="#count-reads-py" title="Link to this heading">¶</a></h5>
<p>Located in parent directory: <code class="docutils literal notranslate"><span class="pre">grid/utils/count_reads.py</span></code></p>
<p><strong>Key Function:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">count_reads</span><span class="p">(</span>
    <span class="n">cram_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ref_fasta</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">chrom</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cram_dir</span></code>: Directory containing CRAM files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_file</span></code>: Output TSV file path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_fasta</span></code>: Reference genome FASTA (for CRAM decoding)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chrom</span></code>: Chromosome name (e.g., “chr6”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code>: Region start coordinate (0-based)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code>: Region end coordinate (0-based)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code>: YAML config with SAM flag filters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threads</span></code>: Parallel processing threads</p></li>
</ul>
<p><strong>Output Format:</strong></p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>sample_id       read_count
sample001       1234
sample002       2345
sample003       3456
</pre></div>
</div>
</section>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h4>
<section id="via-cli">
<h5>Via CLI<a class="headerlink" href="#via-cli" title="Link to this heading">¶</a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grid<span class="w"> </span>count-reads<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cram-dir<span class="w"> </span>data/CRAMs<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output-file<span class="w"> </span>output/read_counts.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ref-fasta<span class="w"> </span>refs/hs37d5.fa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--chrom<span class="w"> </span>chr6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--start<span class="w"> </span><span class="m">160000000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--end<span class="w"> </span><span class="m">160100000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>config.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--threads<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
</section>
<section id="as-python-module">
<h5>As Python Module<a class="headerlink" href="#as-python-module" title="Link to this heading">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">grid.utils.count_reads</span><span class="w"> </span><span class="kn">import</span> <span class="n">count_reads</span>

<span class="n">count_reads</span><span class="p">(</span>
    <span class="n">cram_dir</span><span class="o">=</span><span class="s2">&quot;data/CRAMs&quot;</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/counts.tsv&quot;</span><span class="p">,</span>
    <span class="n">ref_fasta</span><span class="o">=</span><span class="s2">&quot;refs/hs37d5.fa&quot;</span><span class="p">,</span>
    <span class="n">chrom</span><span class="o">=</span><span class="s2">&quot;chr6&quot;</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">160000000</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="mi">160100000</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span>
    <span class="n">threads</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="sam-flag-filtering">
<h4>SAM Flag Filtering<a class="headerlink" href="#sam-flag-filtering" title="Link to this heading">¶</a></h4>
<p>Reads are filtered based on flags specified in the YAML config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sam_flags</span><span class="p">:</span>
<span class="w">  </span><span class="nt">required_flags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PROPER_PAIR</span><span class="w">    </span><span class="c1"># Read is properly paired</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">READ_MAPPED</span><span class="w">    </span><span class="c1"># Read is mapped</span>
<span class="w">  </span><span class="nt">excluded_flags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DUPLICATE</span><span class="w">      </span><span class="c1"># PCR/optical duplicate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SECONDARY</span><span class="w">      </span><span class="c1"># Secondary alignment</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SUPPLEMENTARY</span><span class="w">  </span><span class="c1"># Supplementary alignment</span>
</pre></div>
</div>
<p><strong>Common Required Flags:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PROPER_PAIR</span></code> (0x2): Both reads in pair properly aligned</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ_MAPPED</span></code> (0x1): Read is mapped to reference</p></li>
</ul>
<p><strong>Common Excluded Flags:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DUPLICATE</span></code> (0x400): PCR or optical duplicate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SECONDARY</span></code> (0x100): Not primary alignment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SUPPLEMENTARY</span></code> (0x800): Supplementary alignment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QCFAIL</span></code> (0x200): Fails quality checks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNMAPPED</span></code> (0x4): Read unmapped</p></li>
</ul>
</section>
<section id="technical-details">
<h4>Technical Details<a class="headerlink" href="#technical-details" title="Link to this heading">¶</a></h4>
<section id="algorithm">
<h5>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading">¶</a></h5>
<ol class="arabic simple">
<li><p>Discover all CRAM files in specified directory</p></li>
<li><p>For each CRAM:</p>
<ul class="simple">
<li><p>Ensure .crai index exists</p></li>
<li><p>Open CRAM with reference genome</p></li>
<li><p>Fetch reads overlapping target region</p></li>
<li><p>Filter reads by SAM flags</p></li>
<li><p>Count properly paired reads</p></li>
</ul>
</li>
<li><p>Write results to TSV</p></li>
</ol>
</section>
<section id="performance">
<h5>Performance<a class="headerlink" href="#performance" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p><strong>Parallelization:</strong> Uses multiprocessing to process CRAMs concurrently</p></li>
<li><p><strong>Memory:</strong> Streams reads, minimal memory footprint</p></li>
<li><p><strong>Speed:</strong> ~30-60 seconds per CRAM (varies by region size and coverage)</p></li>
</ul>
</section>
<section id="dependencies">
<h5>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pysam</span></code> - CRAM/BAM reading</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> - Data output</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> - Parallel execution</p></li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h4>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h4>
<p><strong>CRAM index missing:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">index</span> <span class="n">file</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;.</span><span class="n">crai</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span>
</pre></div>
</div>
<p>→ Run <code class="docutils literal notranslate"><span class="pre">grid</span> <span class="pre">crai</span></code> or ensure index files exist</p>
<p><strong>Reference mismatch:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="p">[</span><span class="n">E</span><span class="p">::</span><span class="n">hts_open_format</span><span class="p">]</span> <span class="n">fail</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">file</span>
</pre></div>
</div>
<p>→ Verify reference FASTA matches CRAM build (hg19/hg38)</p>
<p><strong>No reads found:</strong></p>
<ul class="simple">
<li><p>Check chromosome naming (“chr6” vs “6”)</p></li>
<li><p>Verify coordinates are correct for genome build</p></li>
<li><p>Ensure region overlaps with sequencing data</p></li>
</ul>
</section>
</section>
</section>
<section id="python-api-documentation">
<h2>Python API Documentation<a class="headerlink" href="#python-api-documentation" title="Link to this heading">¶</a></h2>
<section id="module-grid.utils.count_reads">
<span id="grid-utils-count-reads"></span><h3>grid.utils.count_reads<a class="headerlink" href="#module-grid.utils.count_reads" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="grid.utils.count_reads.count_reads">
<span class="sig-prename descclassname"><span class="pre">grid.utils.count_reads.</span></span><span class="sig-name descname"><span class="pre">count_reads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cram_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_fasta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chrom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grid.utils.count_reads.count_reads" title="Link to this definition">¶</a></dt>
<dd><p>Count reads for all CRAMs in a directory using parallel processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cram_dir</strong> (<em>str</em>) – Directory containing CRAM files</p></li>
<li><p><strong>output_file</strong> (<em>str</em>) – Path to output TSV file</p></li>
<li><p><strong>ref_fasta</strong> (<em>str</em>) – Path to reference genome FASTA</p></li>
<li><p><strong>chrom</strong> (<em>str</em>) – Chromosome name</p></li>
<li><p><strong>start</strong> (<em>int</em>) – Start position</p></li>
<li><p><strong>end</strong> (<em>int</em>) – End position</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to YAML config file</p></li>
<li><p><strong>threads</strong> (<em>int</em>) – Number of threads for parallel processing</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-grid.utils.count_reads_dir">
<span id="grid-utils-count-reads-dir"></span><h3>grid.utils.count_reads_dir<a class="headerlink" href="#module-grid.utils.count_reads_dir" title="Link to this heading">¶</a></h3>
<p>Count reads utilities.</p>
<p>This package contains modular functions for counting reads
in directories and processing read count results.</p>
<dl class="py function">
<dt class="sig sig-object py" id="grid.utils.count_reads_dir.count_reads_in_region">
<span class="sig-prename descclassname"><span class="pre">grid.utils.count_reads_dir.</span></span><span class="sig-name descname"><span class="pre">count_reads_in_region</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cram_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_fasta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chrom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proper_flags</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grid.utils.count_reads_dir.count_reads_in_region" title="Link to this definition">¶</a></dt>
<dd><p>Count properly paired reads in a genomic region using pysam.
Ensures CRAI index exists.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cram_file</strong> (<em>str</em>)</p></li>
<li><p><strong>ref_fasta</strong> (<em>str</em>)</p></li>
<li><p><strong>chrom</strong> (<em>str</em>)</p></li>
<li><p><strong>start</strong> (<em>int</em>)</p></li>
<li><p><strong>end</strong> (<em>int</em>)</p></li>
<li><p><strong>proper_flags</strong> (<em>set</em><em>[</em><em>int</em><em>]</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grid.utils.count_reads_dir.process_single_cram">
<span class="sig-prename descclassname"><span class="pre">grid.utils.count_reads_dir.</span></span><span class="sig-name descname"><span class="pre">process_single_cram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cram_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_fasta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chrom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proper_flags</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grid.utils.count_reads_dir.process_single_cram" title="Link to this definition">¶</a></dt>
<dd><p>Process a single CRAM file and count reads in region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cram_path</strong> (<em>str</em>) – Path to CRAM file</p></li>
<li><p><strong>ref_fasta</strong> (<em>str</em>) – Path to reference genome FASTA</p></li>
<li><p><strong>chrom</strong> (<em>str</em>) – Chromosome name</p></li>
<li><p><strong>start</strong> (<em>int</em>) – Start position</p></li>
<li><p><strong>end</strong> (<em>int</em>) – End position</p></li>
<li><p><strong>proper_flags</strong> (<em>set</em><em>[</em><em>int</em><em>]</em>) – Set of SAM flags to count</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of (basename, count) where count is int or “Error”</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[str, int | str]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="mosdepth.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Mosdepth Coverage Analysis</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="helper-functions.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Helper Functions</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Zachary Caterer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Read Counting Module</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#read-counting-module">Read Counting Module</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#main-module">Main Module</a><ul>
<li><a class="reference internal" href="#count-reads-py"><code class="docutils literal notranslate"><span class="pre">count_reads.py</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#via-cli">Via CLI</a></li>
<li><a class="reference internal" href="#as-python-module">As Python Module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sam-flag-filtering">SAM Flag Filtering</a></li>
<li><a class="reference internal" href="#technical-details">Technical Details</a><ul>
<li><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li><a class="reference internal" href="#performance">Performance</a></li>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#python-api-documentation">Python API Documentation</a><ul>
<li><a class="reference internal" href="#module-grid.utils.count_reads">grid.utils.count_reads</a><ul>
<li><a class="reference internal" href="#grid.utils.count_reads.count_reads"><code class="docutils literal notranslate"><span class="pre">count_reads()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-grid.utils.count_reads_dir">grid.utils.count_reads_dir</a><ul>
<li><a class="reference internal" href="#grid.utils.count_reads_dir.count_reads_in_region"><code class="docutils literal notranslate"><span class="pre">count_reads_in_region()</span></code></a></li>
<li><a class="reference internal" href="#grid.utils.count_reads_dir.process_single_cram"><code class="docutils literal notranslate"><span class="pre">process_single_cram()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=f8c80a57"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>